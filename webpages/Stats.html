<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Norman Martin-2300232">
    <title>Rick's Auto Shop - Statistics</title>
    <link rel="icon" type="image/x-icon" href="../images/RickAutoIcon.png">
    <link rel="stylesheet" href="../CSS/default.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Styling for layout and charts */
        body {
            background-color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .headerMain {
            background-color: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .headerMain a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }

        .chart-container {
            width: 70%;
            margin: 20px auto;
            text-align: center;
        }

        .footerMain {
            background-color: #333;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .footerMain a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }
    </style>
</head>

<body id="servicePage" name="Top">
    <div class="headerMain headerBorder">
        <div class="bannerLeft">
            <a id="logo" href="../index.html"><img class="centerImg" src="../images/RickAutoLogo.png" alt="Image not found"></a>
            <a id="company" href="../webpages/homePage.html">Rick's Auto Shop &#128191;</a>
        </div>
        <a id="service" href="services.html">Services &#128736;</a>
        <a id="cartPage" href="cartPage.html">Cart &#128736;</a>
        <a id="checkout" href="checkout.html">Checkout &#128722;</a>
        <a id="aboutus" href="Stats.html">Statistics &#128231;</a>
    </div>

    <!-- Main Content Section for Charts -->
    <main>
        <div class="chart-container">
            <h2>Frequency by Gender</h2>
            <canvas id="genderChart"></canvas>
            <img src="../path/to/thinbar.jpg" width="100px" alt="Frequency bar image">
            <div id="genderStats"></div>
        </div>

        <div class="chart-container">
            <h2>Frequency by Age Group</h2>
            <canvas id="ageChart"></canvas>
            <img src="../path/to/thinbar.jpg" width="100px" alt="Frequency bar image">
            <div id="ageStats"></div>
        </div>

        <div id="invoiceContainer"></div>
        <div id="userInvoiceContainer"></div>
    </main>

    <!-- Footer Section -->
    <footer class="footerMain">
        <div>
            <p>Address Block</p>
            <a href="#top">To Top</a> |
            <a href="aboutUs.html">About Us</a>
        </div>
    </footer>

    <!-- JavaScript for Charts and Functions -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            ShowUserFrequency();
            ShowInvoices();
            GetUserInvoices();
        });

        function ShowUserFrequency() {
            const genderData = {
                labels: ['Male', 'Female', 'Other'],
                datasets: [{
                    label: 'Number of Users',
                    data: [35, 45, 20], // Sample data, replace with actual values
                    backgroundColor: ['#3498db', '#e74c3c', '#9b59b6']
                }]
            };

            const genderCtx = document.getElementById('genderChart').getContext('2d');
            new Chart(genderCtx, {
                type: 'bar',
                data: genderData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: { display: true, text: 'User Distribution by Gender' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Number of Users' } }
                    }
                }
            });

            const ageData = {
                labels: ['18-25', '26-35', '36-50', '50+'],
                datasets: [{
                    label: 'Number of Users',
                    data: [15, 25, 30, 10],
                    backgroundColor: '#2ecc71'
                }]
            };

            const ageCtx = document.getElementById('ageChart').getContext('2d');
            new Chart(ageCtx, {
                type: 'bar',
                data: ageData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: { display: true, text: 'User Distribution by Age Group' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Number of Users' } }
                    }
                }
            });
        }

        function ShowInvoices() {
            const invoices = JSON.parse(localStorage.getItem('AllInvoices') || '[]');
            console.log(invoices);
            let invoiceTable = '<table><tr><th>Invoice ID</th><th>Amount</th><th>Date</th></tr>';
            invoices.forEach(invoice => {
                invoiceTable += `<tr><td>${invoice.id}</td><td>${invoice.amount}</td><td>${invoice.date}</td></tr>`;
            });
            invoiceTable += '</table>';
            document.getElementById('invoiceContainer').innerHTML = invoiceTable;
        }

        function GetUserInvoices() {
            const registerData = JSON.parse(localStorage.getItem('RegisterData') || '{}');
            const trn = registerData.trn;
            const allInvoices = JSON.parse(localStorage.getItem('AllInvoices') || '[]');
            const userInvoices = allInvoices.filter(invoice => invoice.trn === trn);
            console.log(userInvoices);
            let invoiceTable = '<table><tr><th>Invoice ID</th><th>Amount</th><th>Date</th></tr>';
            userInvoices.forEach(invoice => {
                invoiceTable += `<tr><td>${invoice.id}</td><td>${invoice.amount}</td><td>${invoice.date}</td></tr>`;
            });
            invoiceTable += '</table>';
            document.getElementById('userInvoiceContainer').innerHTML = invoiceTable;
        }
    </script>
</body>

</html>
